<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Indicadores y Evolución</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background: #f6f7fb; }
    .card { border: 1px solid #e7e9f0; border-radius: 16px; }
    .shadow-soft { box-shadow: 0 10px 30px rgba(16,24,40,.06); }
    .muted { color: #6b7280; }
    .indicator-card { border-left: 6px solid #e5e7eb; }
    .indicator-card.status-red { border-left-color: #dc3545; }
    .indicator-card.status-amber { border-left-color: #f59e0b; }
    .indicator-card.status-green { border-left-color: #16a34a; }
    .indicator-card.status-orange { border-left-color: #fb923c; }
    .indicator-badge { text-transform: uppercase; font-weight: 700; }
    .chart-card { min-height: 360px; }
    .table td, .table th { vertical-align: top; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
  <div class="container py-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
      <div class="d-flex align-items-center gap-2">
        <a href="/estado-proyecto" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left me-1"></i> Volver
        </a>
        <div>
          <h1 class="fw-bold mb-0">Indicadores y Evolución</h1>
          <div class="muted">Proyecto <span class="fw-semibold">{{ project_code }}</span></div>
        </div>
      </div>
      <div class="muted small">Snapshots semanales · Chart.js 4.4.1</div>
    </div>

    <div id="noDataMessage" class="alert alert-warning d-none">
      No hay datos históricos disponibles para este proyecto.
    </div>

    <section class="mb-4">
      <h2 class="h5 fw-semibold mb-3">Indicadores</h2>
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <div class="card shadow-soft indicator-card" id="indicator-productivity">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start gap-3">
                <div>
                  <div class="muted small">Productividad semanal</div>
                  <div class="fw-bold" id="indicator-productivity-label">N/A</div>
                  <div class="muted small" id="indicator-productivity-detail">—</div>
                </div>
                <span class="badge text-bg-secondary indicator-badge" id="indicator-productivity-status">N/A</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card shadow-soft indicator-card" id="indicator-deviation">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start gap-3">
                <div>
                  <div class="muted small">Desviación vs semana anterior</div>
                  <div class="fw-bold" id="indicator-deviation-label">N/A</div>
                  <div class="muted small" id="indicator-deviation-detail">—</div>
                </div>
                <span class="badge text-bg-secondary indicator-badge" id="indicator-deviation-status">N/A</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-4">
          <div class="card shadow-soft indicator-card" id="indicator-phases">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start gap-3">
                <div>
                  <div class="muted small">Fechas de fases</div>
                  <div class="fw-bold" id="indicator-phases-label">N/A</div>
                  <div class="muted small" id="indicator-phases-detail">—</div>
                </div>
                <div class="text-end">
                  <span class="badge text-bg-secondary indicator-badge" id="indicator-phases-status">N/A</span>
                  <button class="btn btn-sm btn-outline-secondary mt-2" id="phaseResetBtn">Reset</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="mb-4">
      <h2 class="h5 fw-semibold mb-3">Gráficas</h2>
      <div class="row g-3">
        <div class="col-12 col-xl-6">
          <div class="card shadow-soft chart-card">
            <div class="card-body">
              <div class="fw-semibold mb-2">Progreso semanal</div>
              <canvas id="chartProgress"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-6">
          <div class="card shadow-soft chart-card">
            <div class="card-body">
              <div class="fw-semibold mb-2">Desviación semanal</div>
              <canvas id="chartDeviation"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-6">
          <div class="card shadow-soft chart-card">
            <div class="card-body">
              <div class="fw-semibold mb-2">Horas reales semanales</div>
              <canvas id="chartRealHours"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-6">
          <div class="card shadow-soft chart-card">
            <div class="card-body">
              <div class="fw-semibold mb-2">Horas reales vs teóricas</div>
              <canvas id="chartHoursCompare"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="card shadow-soft chart-card">
            <div class="card-body">
              <div class="fw-semibold mb-2">Curva S con proyección</div>
              <canvas id="chartSCurve"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2 class="h5 fw-semibold mb-3">Cambios de fechas por fase</h2>
      <div class="card shadow-soft">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Fase</th>
                  <th>Últimos cambios</th>
                  <th>Total cambios</th>
                </tr>
              </thead>
              <tbody id="phaseChangesTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
  <script>
    window.PROJECT_CODE = "{{ project_code }}";
  </script>
  <script src="/static/indicators.js?v=1"></script>
</body>
</html>
