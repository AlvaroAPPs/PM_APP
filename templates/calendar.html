<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calendar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f6f7fb; }
    .card { border: 1px solid #e7e9f0; border-radius: 16px; }
    .shadow-soft { box-shadow: 0 10px 30px rgba(16,24,40,.06); }
    .muted { color: #6b7280; }
    .calendar-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
    .calendar-cell { min-height: 88px; border: 1px solid #e7e9f0; border-radius: 10px; background:#fff; padding:8px; cursor:pointer; }
    .calendar-cell.active { border-color: #0d6efd; box-shadow: inset 0 0 0 1px #0d6efd; }
    .calendar-cell .num { font-weight: 700; }
    .task-chip { font-size: .72rem; border-radius: 999px; padding: 2px 8px; display:inline-block; border: 1px solid transparent; text-align:left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
    .task-chip-task { background:#e7f0ff; border-color:#bfdbfe; color:#1e3a8a; }
    .task-chip-pp { background:#f3e8ff; border-color:#e9d5ff; color:#6b21a8; }
    .task-chip-closed { background:#dcfce7; border-color:#86efac; color:#166534; }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex align-items-center gap-2 mb-3">
      <a href="/menu-personal" class="btn btn-outline-secondary">Volver</a>
      <h1 class="fw-bold mb-0">Calendar</h1>
    </div>

    <div class="card shadow-soft mb-3">
      <div class="card-body d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div class="btn-group" role="group">
          <button id="prevRange" class="btn btn-outline-secondary">Anterior</button>
          <button id="todayRange" class="btn btn-outline-secondary">Hoy</button>
          <button id="nextRange" class="btn btn-outline-secondary">Siguiente</button>
        </div>
        <div id="calendarRangeLabel" class="fw-semibold"></div>
        <div class="btn-group" role="group">
          <button id="viewMonth" class="btn btn-dark">Mes</button>
          <button id="viewWeek" class="btn btn-outline-dark">Semana</button>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-lg-8">
        <div class="card shadow-soft">
          <div class="card-body">
            <div class="calendar-grid mb-2 text-center muted small fw-semibold">
              <div>Lun</div><div>Mar</div><div>Mié</div><div>Jue</div><div>Vie</div><div>Sáb</div><div>Dom</div>
            </div>
            <div id="calendarGrid" class="calendar-grid"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card shadow-soft">
          <div class="card-body">
            <h5 class="mb-2">Tareas de la semana</h5>
            <div id="weekLabel" class="muted small mb-3"></div>
            <div id="weekTasks" class="list-group list-group-flush"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="taskDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalle de tarea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <dl class="row mb-0">
            <dt class="col-sm-3">Proyecto</dt><dd id="detailProject" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Título</dt><dd id="detailTitle" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Tipo</dt><dd id="detailType" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Estado</dt><dd id="detailStatus" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Responsable</dt><dd id="detailOwner" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Fecha prevista</dt><dd id="detailDate" class="col-sm-9">—</dd>
            <dt class="col-sm-3">Descripción</dt><dd id="detailDescription" class="col-sm-9" style="white-space: pre-wrap;">—</dd>
          </dl>
        </div>
        <div class="modal-footer">
          <button id="detailEdit" class="btn btn-outline-secondary">Edit</button>
          <button id="detailClose" class="btn btn-outline-danger">Close</button>
          <button id="detailNavigate" class="btn btn-outline-primary">Navigate</button>
          <button id="detailProjectBtn" class="btn btn-dark">Project</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="taskEditModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar tarea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6"><label class="form-label">Título</label><input id="editTitle" class="form-control" /></div>
            <div class="col-md-6"><label class="form-label">Tipo</label><select id="editType" class="form-select"><option value="TASK">Tarea</option><option value="PP">PP</option></select></div>
            <div class="col-md-6"><label class="form-label">Responsable</label><select id="editOwner" class="form-select"><option value="PM">PM</option><option value="CONSULTORIA">Consultoria</option><option value="TECH">Tech</option><option value="COMERCIAL">Comercial</option><option value="CLIENTE">Cliente</option></select></div>
            <div class="col-md-6"><label class="form-label">Fecha prevista</label><input id="editDate" type="date" class="form-control" /></div>
            <div class="col-md-6"><label class="form-label">Estado</label><select id="editStatus" class="form-select"><option value="OPEN">Abierta</option><option value="IN_PROGRESS">Proceso</option><option value="PAUSED">Parada</option><option value="CLOSED">Cerrada</option></select></div>
            <div class="col-12"><label class="form-label">Descripción</label><textarea id="editDescription" class="form-control" rows="4"></textarea></div>
          </div>
          <div id="editError" class="text-danger small mt-2"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button id="saveEditTask" type="button" class="btn btn-dark">Guardar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/calendar.js?v=1"></script>
</body>
</html>
